<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
<script>
    (function () {
        if ('') {
            if (prompt('请输入文章密码') !== '') {
                alert('密码错误！');
                if (history.length === 1) {
                    location.replace("https://YHE3YAO.github.io"); // 这里替换成你的首页
                } else {
                    history.back();
                }
            }
        }
    })();
</script>
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">

  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "mlpxy22hfwmz8zjzhdhg6bkvk88dn6w0l6n5ey01"
    });
  daovoice('update');
  </script>

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yhe3yao.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="技术运用：Cookie,Redis.">
<meta property="og:type" content="article">
<meta property="og:title" content="单点登录">
<meta property="og:url" content="https://yhe3yao.github.io/2020/04/10/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/index.html">
<meta property="og:site_name" content="YHE3YAO">
<meta property="og:description" content="技术运用：Cookie,Redis.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yhe3yao.github.io/2020/04/10/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="article:published_time" content="2020-04-10T01:22:16.000Z">
<meta property="article:modified_time" content="2020-04-10T11:23:20.386Z">
<meta property="article:author" content="YHE3YAO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yhe3yao.github.io/2020/04/10/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%9B%BE.png">

<link rel="canonical" href="https://yhe3yao.github.io/2020/04/10/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>单点登录 | YHE3YAO</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/YHE3YAO" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YHE3YAO</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://yhe3yao.github.io/2020/04/10/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="YHE3YAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YHE3YAO">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          单点登录
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-10 09:22:16 / 修改时间：19:23:20" itemprop="dateCreated datePublished" datetime="2020-04-10T09:22:16+08:00">2020-04-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">项目实践</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>技术运用：Cookie,Redis.</p>
<a id="more"></a>

<h1 id="单点登录业务流程图"><a href="#单点登录业务流程图" class="headerlink" title="单点登录业务流程图"></a>单点登录业务流程图</h1><p><img src="/2020/04/10/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="单点登录业务流程图.png"></p>
<h1 id="主体涉及文件及附加文件简介"><a href="#主体涉及文件及附加文件简介" class="headerlink" title="主体涉及文件及附加文件简介"></a>主体涉及文件及附加文件简介</h1><p><code>login.html</code>:登录界面</p>
<p><code>SsoServerController.java</code> : 单点登录—服务端</p>
<p><code>SsoClientController.java</code> : 单点登录—客户端</p>
<h2 id="login-html"><a href="#login-html" class="headerlink" title="login.html"></a>login.html</h2><p>这个SSO相关修改：主要是拦截”从哪儿来”的url和“到哪里去”的url;还有一些相关参数（比如：）</p>
<h2 id="SsoServerController-java"><a href="#SsoServerController-java" class="headerlink" title="SsoServerController.java"></a>SsoServerController.java</h2><p>用来基本登录并生成并存放验证数据到redis中 和 拦截登录验证票据（记录拦截”从哪儿来”的url和“到哪里去”的url）</p>
<h2 id="SsoClientController-java"><a href="#SsoClientController-java" class="headerlink" title="SsoClientController.java"></a>SsoClientController.java</h2><p> 拦截登录 验证票据 通过则允许跳转，否侧跳转 Sso登录客户端。</p>
<h1 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>根据单点登录业务流程图向导开发</p>
<h2 id="SsoServerController-java-单点登录服务端"><a href="#SsoServerController-java-单点登录服务端" class="headerlink" title="SsoServerController.java-单点登录服务端"></a>SsoServerController.java-单点登录服务端</h2><h3 id="基本登录"><a href="#基本登录" class="headerlink" title="基本登录"></a>基本登录</h3><p>（用户第一次登录，跳转单点登录服务端）</p>
<p>首先是登录界面，验证用户是否存在和密码是否正确时，在Redis中存放验证记录用户数据。</p>
<ol>
<li>把用户ID写入redis，生成ssoid–&gt;tags(具有时效性)</li>
<li>把生成tags写入redis，生成tags–&gt;st(具有时效性)</li>
<li>将tgc写入到cookie中.</li>
</ol>
<p><code>为什么要存入两道数据在redis中？</code>其目的是生成cookie用于与前端交互，而不能直接传递用户ssoid信息数据给前端。所以一个用户会存入两道数据在redis中。通过st来验证用户登录情况，实现单点登录。</p>
<h3 id="拦截登录-2"><a href="#拦截登录-2" class="headerlink" title="拦截登录(2)"></a>拦截登录(2)</h3><p>（用户访问保护资源，跳转跳转单点登录服务端）</p>
<p>访问时先通过<code>单点登录客户端</code>拦截，验证票据st是否为空和有效。当为空或者无效时，跳转跳转单点登录服务端。</p>
<ol>
<li><p>获取Cooke”tgc”,判断票据是否有效；并删除Redis”tgc”和Cooke”tgs”.</p>
</li>
<li><p>2-1 ）无效；并删除Redis”tgc”、Redis”ssoid”和Cooke”tgs”.</p>
</li>
<li><p>2-2 )   有效；判断st是否为空。空，重新登录；非空，获取票据、刷新tgc,返回票据给调用者。</p>
</li>
</ol>
<h3 id="SsoServerController-java-1"><a href="#SsoServerController-java-1" class="headerlink" title="SsoServerController.java:"></a>SsoServerController.java:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SsoServerController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;URL_PROTAL&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String URL_PROTAL;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">// 基本的登录</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/login/passport/in"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Ret <span class="title">loginByPasswd</span><span class="params">(String username, String password, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">        Ret ret = userService.login(username, password);</span><br><span class="line">        <span class="keyword">if</span>(ret.isSuccess())&#123;</span><br><span class="line">            TSso sso = (TSso) ret.getData();</span><br><span class="line">            <span class="comment">// 1.把用户ID写入redis</span></span><br><span class="line">            RedisUtils.setRedisSsoId(sso.getId());</span><br><span class="line">            <span class="comment">// 2.生成tgc ssoid-&gt;tgc</span></span><br><span class="line">            String tgc = RedisUtils.getSsoTGC(sso.getId() + <span class="string">""</span>);</span><br><span class="line">            <span class="comment">// 3.将tgc写入到cookie中</span></span><br><span class="line">            Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"tgc"</span>, tgc);</span><br><span class="line">            cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">            response.addCookie(cookie);</span><br><span class="line">            <span class="comment">// 4.通过tgc生成st</span></span><br><span class="line">            String st = RedisUtils.getSsoST(tgc);</span><br><span class="line">            ret.setData(st);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String from, String to, Integer relogin,HttpServletRequest request,HttpServletResponse response)</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">        String tgc = <span class="string">""</span>;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cookie.getName().equals(<span class="string">"tgc"</span>)) &#123;</span><br><span class="line">                tgc = cookie.getValue();</span><br><span class="line">                <span class="keyword">if</span> (relogin != <span class="keyword">null</span> &amp;&amp; relogin == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="comment">// 删除tgc</span></span><br><span class="line">                    RedisUtils.deleteSsoTGC(tgc);</span><br><span class="line">                    <span class="comment">// 重置tgc并删除cookie</span></span><br><span class="line">                    tgc = <span class="string">""</span>;</span><br><span class="line">                    cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">                    cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">                    response.addCookie(cookie);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果有tgc 是重新登录 把redis里面的东西 干掉（把第一次登录的东西复原）</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(tgc))&#123;</span><br><span class="line">            <span class="keyword">boolean</span> validateSsoTGC = RedisUtils.validateSsoTGC(tgc);</span><br><span class="line">            <span class="keyword">if</span>(validateSsoTGC)&#123;</span><br><span class="line">                <span class="comment">// 获取票据</span></span><br><span class="line">                String st = RedisUtils.getSsoST(tgc);</span><br><span class="line">                <span class="comment">// 刷新tgc过期时间</span></span><br><span class="line">                RedisUtils.refreshTGCExpires(tgc);</span><br><span class="line">                <span class="comment">// 返回票据给调用者</span></span><br><span class="line">                response.sendRedirect(from + <span class="string">"?st="</span> + st + <span class="string">"&amp;to="</span> + URLEncoder.encode(to, <span class="string">"utf-8"</span>));</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 需要登录</span></span><br><span class="line">        <span class="comment">//response.sendRedirect("/loginpage.html?wwwurl=" + URL_PROTAL + "&amp;from=" + from + "&amp;to=" + URLEncoder.encode(to, "utf-8"));</span></span><br><span class="line">        response.sendRedirect(<span class="string">"/login.html?wwwurl="</span> + URL_PROTAL + <span class="string">"&amp;from="</span> + from + <span class="string">"&amp;to="</span> + URLEncoder.encode(to, <span class="string">"utf-8"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h3><ol>
<li>在springmvc.xml中配置* 加载配置文件-global.properties *</li>
</ol>
<p>springmvc.xml:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 加载配置文件 --&gt;</span><br><span class="line">	&lt;context:property-placeholder location&#x3D;&quot;classpath:resource&#x2F;*.properties&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>global.properties:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CLOOPEN_ACCOUNT_SID&#x3D;8a216da863cde6f90163d54445f90479</span><br><span class="line">CLOOPEN_ACCOUNT_TOKEN&#x3D;64fdf4d53c1d4601a15609fe90c8613f</span><br><span class="line">CLOOPEN_APP_ID&#x3D;8a216da863cde6f90163d5444651047f</span><br><span class="line">CLOOPEN_SMS_CODE_TEMPALTE_ID&#x3D;1</span><br><span class="line">URL_PROTAL&#x3D;http:&#x2F;&#x2F;127.0.0.1:80&#x2F;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>Ret.java封装AJAX请求后的结果数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 封装AJAX请求后的结果数据</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class Ret implements Serializable&#123;</span><br><span class="line">	private static final long serialVersionUID &#x3D; 8777098949345414562L;</span><br><span class="line"></span><br><span class="line">	public static final String quote &#x3D; &quot;\&quot;&quot;;</span><br><span class="line">	</span><br><span class="line">	private boolean success &#x3D; true;</span><br><span class="line">	private int code &#x3D; ICodes.SUCCESS;</span><br><span class="line">	private String message &#x3D; &quot;&quot;;</span><br><span class="line">	private String info &#x3D; &quot;&quot;;</span><br><span class="line">	private Object data &#x3D; null;</span><br><span class="line"></span><br><span class="line">	public static Ret me() &#123;</span><br><span class="line">		return new Ret();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret() &#123;</span><br><span class="line">		this.code &#x3D; ICodes.SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret(int code) &#123;</span><br><span class="line">		this.code &#x3D; code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret(boolean isSuccess, int code) &#123;</span><br><span class="line">		this.success &#x3D; isSuccess;</span><br><span class="line">		this.code &#x3D; code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret(boolean success, int code, Object data) &#123;</span><br><span class="line">		this.data &#x3D; data;</span><br><span class="line">		this.success &#x3D; success;</span><br><span class="line">		this.code &#x3D; code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret setSuccess(boolean isSuccess) &#123;</span><br><span class="line">		this.success &#x3D; isSuccess;</span><br><span class="line">		if (!this.success)</span><br><span class="line">			this.code &#x3D; ICodes.FAILED;</span><br><span class="line">		return this;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public boolean isSuccess() &#123;</span><br><span class="line">		return this.success;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret setCode(int code) &#123;</span><br><span class="line">		this.code &#x3D; code;</span><br><span class="line">		if(ICodes.FAILED&#x3D;&#x3D;code)&#123;</span><br><span class="line">			this.success &#x3D; false;</span><br><span class="line">		&#125;else if (ICodes.SUCCESS &#x3D;&#x3D; code) &#123;</span><br><span class="line">			this.success &#x3D; true;</span><br><span class="line">		&#125;</span><br><span class="line">		return this;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public int getCode() &#123;</span><br><span class="line">		return this.code;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getMessage() &#123;</span><br><span class="line">		String _msg &#x3D; ConstUtils.getMsgConstName(code);</span><br><span class="line">		if (_msg &#x3D;&#x3D; null)</span><br><span class="line">			_msg &#x3D; &quot;&quot;;</span><br><span class="line">		message &#x3D; _msg;</span><br><span class="line">		return message;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String getInfo() &#123;</span><br><span class="line">		return this.info;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret setInfo(String info) &#123;</span><br><span class="line">		this.info &#x3D; info;</span><br><span class="line">		return this;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Ret setData(Object data) &#123;</span><br><span class="line">		this.data &#x3D; data;</span><br><span class="line">		return this;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Object getData() &#123;</span><br><span class="line">		return this.data;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public String toString() &#123;</span><br><span class="line">		StringBuffer sb &#x3D; new StringBuffer();</span><br><span class="line">		sb.append(&quot;&#123;&quot;);</span><br><span class="line">		sb.append(quote + &quot;code&quot; + quote + &quot;:&quot;);</span><br><span class="line">		sb.append(code);</span><br><span class="line">		sb.append(&quot;,&quot; + quote + &quot;success&quot; + quote + &quot;:&quot;);</span><br><span class="line">		sb.append(success);</span><br><span class="line">		sb.append(&quot;,&quot; + quote + &quot;message&quot; + quote + &quot;:&quot;);</span><br><span class="line">		sb.append(quote + encode(this.getMessage()) + quote);</span><br><span class="line">		sb.append(&quot;,&quot; + quote + &quot;info&quot; + quote + &quot;:&quot;);</span><br><span class="line">		sb.append(quote + encode(info) + quote);</span><br><span class="line">		if (null !&#x3D; this.data) &#123;</span><br><span class="line">			sb.append(&quot;,&quot; + quote + &quot;data&quot; + quote + &quot;:&quot;);</span><br><span class="line">			if (data instanceof String) &#123;</span><br><span class="line">				sb.append(data);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				sb.append(JSON.toJSONString(data));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		sb.append(&quot;&#125;&quot;);</span><br><span class="line">		return sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private String encode(String text) &#123;</span><br><span class="line">		if (null &#x3D;&#x3D; text)</span><br><span class="line">			return &quot;&quot;;</span><br><span class="line">		String _text &#x3D; text.replace(&quot;\&quot;&quot;, &quot;“&quot;);</span><br><span class="line">		return _text;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.RedisUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtils</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 可用连接实例的最大数目，默认值为8；</span></span><br><span class="line">	<span class="comment">// 如果赋值为-1，则表示不限制；如果pool已经分配了maxTotal个jedis实例，则此时pool的状态为exhausted(耗尽)。</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_TOTAL = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 控制一个pool最多有多少个状态为idle(空闲的)的jedis实例，默认值也是8。</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_IDLE = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 等待可用连接的最大时间，单位毫秒，默认值为-1，表示永不超时。如果超过等待时间，则直接抛出JedisConnectionException；</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_WAIT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 超时时间 毫秒</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> TIMEOUT = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 初始化Redis连接池</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">			<span class="comment">// 连接耗尽时是否阻塞, false报异常,ture阻塞直到超时, 默认true</span></span><br><span class="line">			config.setBlockWhenExhausted(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">// 设置的逐出策略类名, 默认DefaultEvictionPolicy(当连接超过最大空闲时间,或连接数超过最大空闲连接数)</span></span><br><span class="line">			config.setEvictionPolicyClassName(<span class="string">"org.apache.commons.pool2.impl.DefaultEvictionPolicy"</span>);</span><br><span class="line">			<span class="comment">// 是否启用pool的jmx管理功能, 默认true</span></span><br><span class="line">			config.setJmxEnabled(<span class="keyword">true</span>);</span><br><span class="line">			<span class="comment">// 最大空闲连接数, 默认8个 控制一个pool最多有多少个状态为idle(空闲的)的jedis实例。</span></span><br><span class="line">			config.setMaxIdle(MAX_IDLE);</span><br><span class="line">			<span class="comment">// 最大连接数, 默认8个</span></span><br><span class="line">			config.setMaxTotal(MAX_TOTAL);</span><br><span class="line">			<span class="comment">// 表示当borrow(引入)一个jedis实例时，最大的等待时间，如果超过等待时间，则直接抛出JedisConnectionException；</span></span><br><span class="line">			config.setMaxWaitMillis(MAX_WAIT);</span><br><span class="line">			<span class="comment">// 在borrow一个jedis实例时，是否提前进行validate操作；如果为true，则得到的jedis实例均是可用的；</span></span><br><span class="line">			config.setTestOnBorrow(<span class="keyword">true</span>);</span><br><span class="line">			config.setTestOnReturn(<span class="keyword">true</span>);</span><br><span class="line">			jedisPool = <span class="keyword">new</span> JedisPool(config, <span class="string">"192.168.1.235"</span>, <span class="number">6379</span>, TIMEOUT);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取Jedis实例</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Jedis <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Jedis resource = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (jedisPool != <span class="keyword">null</span>) &#123;</span><br><span class="line">				resource = jedisPool.getResource();</span><br><span class="line">				<span class="keyword">return</span> resource;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (JedisConnectionException e) &#123;</span><br><span class="line">			close(resource);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @功能：通过Redis的key获取值，并释放连接资源</span></span><br><span class="line"><span class="comment">	 * @参数：key，键值 @返回： 成功返回value，失败返回null</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">		String value = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			jedis = getInstance();</span><br><span class="line">			value = jedis.get(key);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @功能：向redis存入key和value（如果key已经存在 则覆盖），并释放连接资源</span></span><br><span class="line"><span class="comment">	 * @参数：key，键</span></span><br><span class="line"><span class="comment">	 * @参数：value，与key对应的值 @返回：成功返回“OK”，失败返回“FAIL”</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">		String ret = <span class="string">"FAIL"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			jedis = getInstance();</span><br><span class="line">			ret = jedis.set(key, value);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @功能：向redis存入具有过期时间的key和value（如果key已经存在 则覆盖），并释放连接资源</span></span><br><span class="line"><span class="comment">	 * @参数：key，键</span></span><br><span class="line"><span class="comment">	 * @参数：seconds，过期时间（秒） @参数：value，与key对应的值 @返回：成功返回“OK”，失败返回“FAIL”</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">setex</span><span class="params">(String key, Integer seconds, String value)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">		String ret = <span class="string">"FAIL"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			jedis = getInstance();</span><br><span class="line">			ret = jedis.setex(key, seconds, value);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @功能：通过Redis的key删除，并释放连接资源</span></span><br><span class="line"><span class="comment">	 * @参数：key，键值 @返回： 成功返回value，失败返回null</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">del</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">		Long ret = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			jedis = getInstance();</span><br><span class="line">			ret = jedis.del(key);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @功能：通过Redis设置key的过期时间，并释放连接资源</span></span><br><span class="line"><span class="comment">	 * @参数：key，键值</span></span><br><span class="line"><span class="comment">	 * @参数：seconds，过期秒数 @返回： 成功返回value，失败返回null</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> seconds)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">		Long ret = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			jedis = getInstance();</span><br><span class="line">			ret = jedis.expire(key, seconds);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">		Long ret = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			jedis = getInstance();</span><br><span class="line">			ret = jedis.decr(key);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			close(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 释放jedis资源</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> jedis</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(<span class="keyword">final</span> Jedis jedis)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (jedis != <span class="keyword">null</span>) &#123;</span><br><span class="line">			jedis.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Jedis jedis = RedisUtils.getInstance();</span><br><span class="line">		<span class="comment">// jedis.set("test", "nixianhua");</span></span><br><span class="line">		System.out.println(jedis.get(<span class="string">"SMSCODE:18000534097"</span>));</span><br><span class="line">		<span class="comment">// RedisUtil.testString(jedis);</span></span><br><span class="line">		<span class="comment">// RedisUtils.testMap(jedis);</span></span><br><span class="line">		<span class="comment">// RedisUtils.testList(jedis);</span></span><br><span class="line">		<span class="comment">// RedisUtils.testSet(jedis);</span></span><br><span class="line">		RedisUtils.close(jedis);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 字符串测试</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> jedis</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testString</span><span class="params">(Jedis jedis)</span> </span>&#123;</span><br><span class="line">		jedis.set(<span class="string">"name"</span>, <span class="string">"xxxx"</span>);<span class="comment">// 向key--&gt;name中放入了value--&gt;xinxin</span></span><br><span class="line">		System.out.println(jedis.get(<span class="string">"name"</span>));<span class="comment">// 执行结果：xinxin</span></span><br><span class="line"></span><br><span class="line">		jedis.append(<span class="string">"name"</span>, <span class="string">" is my lover"</span>); <span class="comment">// 拼接</span></span><br><span class="line">		System.out.println(jedis.get(<span class="string">"name"</span>));</span><br><span class="line"></span><br><span class="line">		jedis.del(<span class="string">"name"</span>); <span class="comment">// 删除某个键</span></span><br><span class="line">		System.out.println(jedis.get(<span class="string">"name"</span>));</span><br><span class="line">		<span class="comment">// 设置多个键值对</span></span><br><span class="line">		jedis.mset(<span class="string">"name"</span>, <span class="string">"某某某"</span>, <span class="string">"age"</span>, <span class="string">"24"</span>, <span class="string">"qq"</span>, <span class="string">"476777XXX"</span>);</span><br><span class="line">		jedis.incr(<span class="string">"age"</span>); <span class="comment">// 进行加1操作</span></span><br><span class="line">		System.out.println(jedis.get(<span class="string">"name"</span>) + <span class="string">"-"</span> + jedis.get(<span class="string">"age"</span>) + <span class="string">"-"</span> + jedis.get(<span class="string">"qq"</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * map 用法</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> jedis</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testMap</span><span class="params">(Jedis jedis)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// -----添加数据----------</span></span><br><span class="line">		Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">		map.put(<span class="string">"name"</span>, <span class="string">"xinxin"</span>);</span><br><span class="line">		map.put(<span class="string">"age"</span>, <span class="string">"22"</span>);</span><br><span class="line">		map.put(<span class="string">"qq"</span>, <span class="string">"123456"</span>);</span><br><span class="line">		jedis.hmset(<span class="string">"user"</span>, map);</span><br><span class="line">		<span class="comment">// 取出user中的name，执行结果:[minxr]--&gt;注意结果是一个泛型的List</span></span><br><span class="line">		<span class="comment">// 第一个参数是存入redis中map对象的key，后面跟的是放入map中的对象的key，后面的key可以跟多个，是可变参数</span></span><br><span class="line">		List&lt;String&gt; rsmap = jedis.hmget(<span class="string">"user"</span>, <span class="string">"name"</span>, <span class="string">"age"</span>, <span class="string">"qq"</span>);</span><br><span class="line">		System.out.println(rsmap);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 删除map中的某个键值</span></span><br><span class="line">		jedis.hdel(<span class="string">"user"</span>, <span class="string">"age"</span>);</span><br><span class="line">		System.out.println(jedis.hmget(<span class="string">"user"</span>, <span class="string">"age"</span>)); <span class="comment">// 因为删除了，所以返回的是null</span></span><br><span class="line">		System.out.println(jedis.hlen(<span class="string">"user"</span>)); <span class="comment">// 返回key为user的键中存放的值的个数2</span></span><br><span class="line">		System.out.println(jedis.exists(<span class="string">"user"</span>));<span class="comment">// 是否存在key为user的记录 返回true</span></span><br><span class="line">		System.out.println(jedis.hkeys(<span class="string">"user"</span>));<span class="comment">// 返回map对象中的所有key</span></span><br><span class="line">		System.out.println(jedis.hvals(<span class="string">"user"</span>));<span class="comment">// 返回map对象中的所有value</span></span><br><span class="line"></span><br><span class="line">		Iterator&lt;String&gt; iter = jedis.hkeys(<span class="string">"user"</span>).iterator();</span><br><span class="line">		<span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">			String key = iter.next();</span><br><span class="line">			System.out.println(key + <span class="string">":"</span> + jedis.hmget(<span class="string">"user"</span>, key));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * jedis操作List</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">(Jedis jedis)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 开始前，先移除所有的内容</span></span><br><span class="line">		jedis.del(<span class="string">"java framework"</span>);</span><br><span class="line">		System.out.println(jedis.lrange(<span class="string">"java framework"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">		<span class="comment">// 先向key java framework中存放三条数据</span></span><br><span class="line">		jedis.lpush(<span class="string">"java framework"</span>, <span class="string">"spring"</span>);</span><br><span class="line">		jedis.lpush(<span class="string">"java framework"</span>, <span class="string">"struts"</span>);</span><br><span class="line">		jedis.lpush(<span class="string">"java framework"</span>, <span class="string">"hibernate"</span>);</span><br><span class="line">		<span class="comment">// 再取出所有数据jedis.lrange是按范围取出，</span></span><br><span class="line">		<span class="comment">// 第一个是key，第二个是起始位置，第三个是结束位置，jedis.llen获取长度 -1表示取得所有</span></span><br><span class="line">		System.out.println(jedis.lrange(<span class="string">"java framework"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">		jedis.del(<span class="string">"java framework"</span>);</span><br><span class="line">		jedis.rpush(<span class="string">"java framework"</span>, <span class="string">"spring"</span>);</span><br><span class="line">		jedis.rpush(<span class="string">"java framework"</span>, <span class="string">"struts"</span>);</span><br><span class="line">		jedis.rpush(<span class="string">"java framework"</span>, <span class="string">"hibernate"</span>);</span><br><span class="line">		System.out.println(jedis.lrange(<span class="string">"java framework"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * jedis操作Set</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testSet</span><span class="params">(Jedis jedis)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 添加</span></span><br><span class="line">		jedis.sadd(<span class="string">"user"</span>, <span class="string">"liuling"</span>);</span><br><span class="line">		jedis.sadd(<span class="string">"user"</span>, <span class="string">"xinxin"</span>);</span><br><span class="line">		jedis.sadd(<span class="string">"user"</span>, <span class="string">"ling"</span>);</span><br><span class="line">		jedis.sadd(<span class="string">"user"</span>, <span class="string">"zhangxinxin"</span>);</span><br><span class="line">		jedis.sadd(<span class="string">"user"</span>, <span class="string">"who"</span>);</span><br><span class="line">		<span class="comment">// 移除noname</span></span><br><span class="line">		jedis.srem(<span class="string">"user"</span>, <span class="string">"who"</span>);</span><br><span class="line">		System.out.println(jedis.smembers(<span class="string">"user"</span>));<span class="comment">// 获取所有加入的value</span></span><br><span class="line">		System.out.println(jedis.sismember(<span class="string">"user"</span>, <span class="string">"who"</span>));<span class="comment">// 判断 who</span></span><br><span class="line">															<span class="comment">// 是否是user集合的元素</span></span><br><span class="line">		System.out.println(jedis.srandmember(<span class="string">"user"</span>));</span><br><span class="line">		System.out.println(jedis.scard(<span class="string">"user"</span>));<span class="comment">// 返回集合的元素个数</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// -------------------------------华丽的分割线-----------------------------------------------------</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSsoTGC</span><span class="params">(String ssoId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> expireSeconds = <span class="number">30</span> * <span class="number">600</span>;</span><br><span class="line">		String tgc = MD5.getMD5(ssoId + StrUtils.getComplexRandomString(<span class="number">32</span>));</span><br><span class="line">		String tgt = ssoId;</span><br><span class="line">		String tgcKey = <span class="string">"TGC-"</span> + tgc;</span><br><span class="line">		RedisUtils.setex(tgcKey, expireSeconds, tgt);</span><br><span class="line">		<span class="keyword">return</span> tgc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">refreshTGCExpires</span><span class="params">(String tgc)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> expireSeconds = <span class="number">30</span> * <span class="number">600</span>;</span><br><span class="line">		String tgcKey = <span class="string">"TGC-"</span> + tgc;</span><br><span class="line">		RedisUtils.expire(tgcKey, expireSeconds);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteSsoTGC</span><span class="params">(String tgc)</span> </span>&#123;</span><br><span class="line">		String tgcKey = <span class="string">"TGC-"</span> + tgc;</span><br><span class="line">		String tgt = RedisUtils.get(tgcKey);</span><br><span class="line">		RedisUtils.del(tgcKey);</span><br><span class="line">		<span class="comment">// 同时删除SsoId</span></span><br><span class="line">		String ssoIdKey = <span class="string">"u-"</span> + tgt;</span><br><span class="line">		RedisUtils.del(ssoIdKey);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">validateSsoTGC</span><span class="params">(String tgc)</span> </span>&#123;</span><br><span class="line">		String tgcKey = <span class="string">"TGC-"</span> + tgc;</span><br><span class="line">		String cacheTgc = RedisUtils.get(tgcKey);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span> != cacheTgc;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSsoST</span><span class="params">(String tgc)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// int expireSeconds = 30;</span></span><br><span class="line">		<span class="keyword">int</span> expireSeconds = <span class="number">3000</span>;</span><br><span class="line">		String tgcKey = <span class="string">"TGC-"</span> + tgc;</span><br><span class="line">		String tgt = RedisUtils.get(tgcKey);</span><br><span class="line">		String st = MD5.getMD5(tgt + StrUtils.getComplexRandomString(<span class="number">32</span>));</span><br><span class="line">		String stKey = <span class="string">"ST-"</span> + st;</span><br><span class="line">		RedisUtils.setex(stKey, expireSeconds, tgt);</span><br><span class="line">		<span class="keyword">return</span> st;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">validateSsoST</span><span class="params">(String st)</span> </span>&#123;</span><br><span class="line">		String stKey = <span class="string">"ST-"</span> + st;</span><br><span class="line">		String tgt = RedisUtils.get(stKey);</span><br><span class="line">		RedisUtils.del(stKey);</span><br><span class="line">		<span class="keyword">return</span> tgt;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setRedisSsoId</span><span class="params">(Long ssoId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> expireSeconds = <span class="number">30</span> * <span class="number">60</span>;</span><br><span class="line">		String key = <span class="string">"u-"</span> + ssoId;</span><br><span class="line">		RedisUtils.setex(key, expireSeconds, ssoId.toString());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">refreshRedisSsoId</span><span class="params">(Long ssoId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> expireSeconds = <span class="number">30</span> * <span class="number">600</span>;</span><br><span class="line">		String key = <span class="string">"u-"</span> + ssoId;</span><br><span class="line">		Long ret = RedisUtils.expire(key, expireSeconds);</span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRedisSsoId</span><span class="params">(Long ssoId)</span> </span>&#123;</span><br><span class="line">		String key = <span class="string">"u-"</span> + ssoId;</span><br><span class="line">		<span class="keyword">return</span> RedisUtils.get(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">delRedisSsoId</span><span class="params">(Long ssoId)</span> </span>&#123;</span><br><span class="line">		String key = <span class="string">"u-"</span> + ssoId;</span><br><span class="line">		<span class="keyword">return</span> RedisUtils.del(key);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="SsoClientController-java-单点登录客户端"><a href="#SsoClientController-java-单点登录客户端" class="headerlink" title="SsoClientController.java-单点登录客户端"></a>SsoClientController.java-单点登录客户端</h2><h3 id="拦截登录-前"><a href="#拦截登录-前" class="headerlink" title="拦截登录(前)"></a>拦截登录(前)</h3><p>（用户访问保护资源，跳转单点登录客户端）</p>
<p>用户可以不用登录访问资源，但当访问保护资源“拦截路径资源”时进去SsoClientController.java-单点登录客户端。</p>
<ol>
<li>没票时，重定向<code>单点登录客户端地址</code>，携带<code>单点登录服务端访问地址</code>from和<code>被拦截地址to</code>.</li>
<li>有票时，判断票据是否有效<ul>
<li>有效，跳转<code>被拦截地址to</code>.</li>
<li>无效，重定向<code>单点登录客户端地址</code>，携带<code>单点登录服务端访问地址</code>from，被拦截地址to.<code>和参数：relogin用于跳转单点登录服务端</code>清空Cookie和Redis.</li>
</ul>
</li>
</ol>
<p>在springmvc.xml配置文件中配置* 拦截器 *.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 拦截器配置 --&gt;</span><br><span class="line">	&lt;mvc:interceptors&gt;</span><br><span class="line">		&lt;mvc:interceptor&gt;</span><br><span class="line">			&lt;mvc:mapping path&#x3D;&quot;&#x2F;cart&#x2F;**&quot; &#x2F;&gt;</span><br><span class="line">			&lt;mvc:exclude-mapping path&#x3D;&quot;*.jsp&quot; &#x2F;&gt;</span><br><span class="line">			&lt;bean id&#x3D;&quot;loginInterceptor&quot; class&#x3D;&quot;com.yaorange.interceptor.LoginInterceptor&quot; &#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;mvc:interceptor&gt;</span><br><span class="line">	</span><br><span class="line">	&lt;&#x2F;mvc:interceptors&gt;</span><br></pre></td></tr></table></figure>

<h3 id="SsoClientController-java-1"><a href="#SsoClientController-java-1" class="headerlink" title="SsoClientController.java"></a>SsoClientController.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/client"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SsoClientController</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;URL_SERVER_LOGIN&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String URL_SERVER_LOGIN;<span class="comment">// http://127.0.0.1:8091/login</span></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;URL_SERVER_REG&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String URL_SERVER_REG;<span class="comment">// http://127.0.0.1:8091/reg.phone.html</span></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;URL_SERVER_LOGOUT&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String URL_SERVER_LOGOUT;<span class="comment">// http://127.0.0.1:8091/logout</span></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;URL_CLIENT_LOGIN&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String URL_CLIENT_LOGIN;<span class="comment">// client/login</span></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;URL_PROTAL&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String URL_PROTAL;<span class="comment">// http://127.0.0.1:80/</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TSsoMapper ssoMapper;</span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String st,String to)</span> <span class="keyword">throws</span>  Exception</span>&#123;</span><br><span class="line">		String redirectUrl=<span class="string">""</span>;</span><br><span class="line">		<span class="comment">//来自东土大唐</span></span><br><span class="line">		String fromUrl=URL_PROTAL+URL_CLIENT_LOGIN;</span><br><span class="line">		<span class="comment">//没票</span></span><br><span class="line">		<span class="keyword">if</span>(StringUtils.isEmpty(st))&#123;</span><br><span class="line">			redirectUrl=URL_SERVER_LOGIN + <span class="string">"?from="</span> + fromUrl + <span class="string">"&amp;to="</span> + URLEncoder.encode(to, <span class="string">"utf-8"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//有票</span></span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			String ssoId = RedisUtils.validateSsoST(st);</span><br><span class="line">			<span class="comment">//票据有效</span></span><br><span class="line">			<span class="keyword">if</span>(StringUtils.isNotEmpty(ssoId))&#123;</span><br><span class="line">				TSso sso = ssoMapper.selectByPrimaryKey(Long.parseLong(ssoId));</span><br><span class="line">				SsoContext.setSso(sso);</span><br><span class="line">				redirectUrl=to;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 票据无效</span></span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				redirectUrl = URL_SERVER_LOGIN + <span class="string">"?relogin=1&amp;from="</span> + fromUrl + <span class="string">"&amp;to="</span> + URLEncoder.encode(to, <span class="string">"utf-8"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"redirect:"</span>+redirectUrl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中注意login.html的几个地方：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">加载前准备：</span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    $().ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> href = $(<span class="string">'#ssoRegLink'</span>).attr(<span class="string">"href"</span>);</span><br><span class="line">							<span class="keyword">var</span> params = getHtmlParmas();</span><br><span class="line">							<span class="keyword">var</span> fr = params[<span class="string">'from'</span>] || <span class="string">'/ssoLogin'</span>;</span><br><span class="line">							<span class="keyword">var</span> to = params[<span class="string">'to'</span>] || <span class="string">''</span>;</span><br><span class="line">							href+=<span class="string">'?from='</span>+fr+<span class="string">'&amp;to='</span>+to;</span><br><span class="line">							$(<span class="string">'#ssoRegLink'</span>).attr(<span class="string">'href'</span>,href);</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line"><span class="comment">//提交登录信息							$(container).find("#passprotForm").ajaxForm(function(data)&#123;</span></span><br><span class="line">								<span class="keyword">var</span> url = location.href;</span><br><span class="line">								<span class="keyword">if</span>(data.success)&#123;</span><br><span class="line">									<span class="keyword">var</span> params = getHtmlParmas();</span><br><span class="line">									<span class="keyword">var</span> fr = params[<span class="string">'from'</span>];</span><br><span class="line">									<span class="keyword">var</span> to = params[<span class="string">'to'</span>] || <span class="string">''</span>;</span><br><span class="line">									 </span><br><span class="line">									<span class="keyword">var</span> wwwurl = params[<span class="string">'wwwurl'</span>] || <span class="string">'/'</span>;</span><br><span class="line">									<span class="keyword">if</span>((<span class="keyword">typeof</span> fr)==<span class="string">"undefined"</span> || <span class="string">''</span>==fr || <span class="literal">null</span>==fr)&#123;</span><br><span class="line">										location.href = wwwurl;</span><br><span class="line">									&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">										location.href = fr+<span class="string">'?st='</span>+data.data+<span class="string">'&amp;to='</span>+to;</span><br><span class="line">									&#125;</span><br><span class="line">								&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">									$(<span class="string">'#passprotForm'</span>).find(<span class="string">'.form-control-box'</span>).addClass(<span class="string">'error'</span>);</span><br><span class="line">									$(<span class="string">'#usernameGroup'</span>).append(<span class="string">'&lt;span id="username-error" data-error-id="username" class="form-control-error"&gt;&lt;i class="fa fa-warning"&gt;&lt;/i&gt;'</span>+data.message+<span class="string">' '</span>+data.info+<span class="string">'&lt;/span&gt;'</span>);</span><br><span class="line">									$.msg(data.message+<span class="string">" "</span>+data.info, &#123;<span class="attr">time</span>: <span class="number">5000</span>&#125;);</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="补充说明："><a href="#补充说明：" class="headerlink" title="补充说明："></a>补充说明：</h3><p>common.js:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;转换html参数为json对象</span><br><span class="line">function getHtmlParmas()&#123;</span><br><span class="line">	&#x2F;&#x2F;解析参数</span><br><span class="line">	var paramObj &#x3D; &#123;&#125;;</span><br><span class="line">	var pindex &#x3D; location.href.indexOf(&#39;?&#39;);</span><br><span class="line">	if(pindex&gt;0)&#123;</span><br><span class="line">		var params &#x3D; location.href.substring(pindex+1);</span><br><span class="line">		var paramArr &#x3D; params.split(&#39;&amp;&#39;);</span><br><span class="line">		for(var i&#x3D;0;i&lt;paramArr.length;i++)&#123;</span><br><span class="line">			var kv &#x3D; paramArr[i].split(&#39;&#x3D;&#39;);</span><br><span class="line">			if(&#39;#&#39;!&#x3D;kv[1])&#123;</span><br><span class="line">				paramObj[kv[0]] &#x3D; decodeURI(kv[1]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return paramObj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoginInterceptor.java:客户端登录拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;URL_CLIENT_LOGIN&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String URL_CLIENT_LOGIN;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        TSso sso = SsoContext.getSso();</span><br><span class="line">        <span class="keyword">boolean</span> isLogin = sso!=<span class="keyword">null</span>;</span><br><span class="line">        String to = request.getHeader(<span class="string">"Referer"</span>);</span><br><span class="line">        <span class="comment">//如果用户没有登录</span></span><br><span class="line">        <span class="keyword">if</span>(!isLogin)&#123;</span><br><span class="line">            String clientLogin = <span class="string">"/"</span> + URL_CLIENT_LOGIN;</span><br><span class="line">            clientLogin += <span class="string">"?to="</span> + URLEncoder.encode(to, <span class="string">"utf-8"</span>);</span><br><span class="line">            Ret ret = Ret.me().setSuccess(<span class="keyword">false</span>).setCode(ICodes.UNAUTHED).setData(clientLogin);</span><br><span class="line">            String retJson = JSON.toJSONString(ret);</span><br><span class="line">            response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">            response.getWriter().write(retJson);</span><br><span class="line">            response.getWriter().flush();</span><br><span class="line">            response.getWriter().close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果登录了</span></span><br><span class="line">        <span class="keyword">if</span>(isLogin)&#123;</span><br><span class="line">            String redisSsoId = RedisUtils.getRedisSsoId(sso.getId());</span><br><span class="line">            <span class="comment">//如果redis登录信息没有过期</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(redisSsoId))&#123;</span><br><span class="line">                <span class="comment">//刷新过期时间</span></span><br><span class="line">                RedisUtils.refreshRedisSsoId(sso.getId());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                SsoContext.logOut();</span><br><span class="line">                isLogin=<span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isLogin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Redies-Linux下命令补充"><a href="#Redies-Linux下命令补充" class="headerlink" title="Redies-Linux下命令补充"></a>Redies-Linux下命令补充</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.$cd &#x2F;usr&#x2F;local&#x2F;redis&#x2F;bin&#x2F;</span><br><span class="line">2.$ll</span><br><span class="line">3.$.&#x2F;redis-cli</span><br><span class="line">4.$key *   --显示所有key</span><br><span class="line">5.$get key --获取value值</span><br><span class="line">6.$del key --删除数据</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
     
     <div>
      
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
      
    </div>

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/04/docker/" rel="prev" title="docker">
      <i class="fa fa-chevron-left"></i> docker
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#单点登录业务流程图"><span class="nav-number">1.</span> <span class="nav-text">单点登录业务流程图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#主体涉及文件及附加文件简介"><span class="nav-number">2.</span> <span class="nav-text">主体涉及文件及附加文件简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#login-html"><span class="nav-number">2.1.</span> <span class="nav-text">login.html</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SsoServerController-java"><span class="nav-number">2.2.</span> <span class="nav-text">SsoServerController.java</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SsoClientController-java"><span class="nav-number">2.3.</span> <span class="nav-text">SsoClientController.java</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开发流程"><span class="nav-number">3.</span> <span class="nav-text">开发流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SsoServerController-java-单点登录服务端"><span class="nav-number">3.2.</span> <span class="nav-text">SsoServerController.java-单点登录服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本登录"><span class="nav-number">3.2.1.</span> <span class="nav-text">基本登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#拦截登录-2"><span class="nav-number">3.2.2.</span> <span class="nav-text">拦截登录(2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SsoServerController-java-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">SsoServerController.java:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#补充说明"><span class="nav-number">3.2.4.</span> <span class="nav-text">补充说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SsoClientController-java-单点登录客户端"><span class="nav-number">3.3.</span> <span class="nav-text">SsoClientController.java-单点登录客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#拦截登录-前"><span class="nav-number">3.3.1.</span> <span class="nav-text">拦截登录(前)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SsoClientController-java-1"><span class="nav-number">3.3.2.</span> <span class="nav-text">SsoClientController.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#补充说明："><span class="nav-number">3.3.3.</span> <span class="nav-text">补充说明：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redies-Linux下命令补充"><span class="nav-number">4.</span> <span class="nav-text">Redies-Linux下命令补充</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">YHE3YAO</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YHE3YAO</span>
</div>
  <div class="powered-by">
     <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
     本站访客数:<span id="busuanzi_value_site_uv"></span>
    </span>
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共20.6k字</span>
</div>
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
